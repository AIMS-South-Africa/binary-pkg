name: SageMath

repository: https://github.com/sagemath/sage.git
branch: develop

build: |
    export SAGE_FAT_BINARY=yes
    export SAGE_PARALLEL_SPKG_BUILD=yes
    export SAGE_ATLAS_ARCH=Corei2,SSE3,SSE2,SSE1
    export SAGE_ATLAS_LIB=/home/vbraun/Sage/ATLAS
    export MAKE='make -j{ncpu}'
    make
    git gc --aggressive --prune=now

version: |
    source src/bin/sage-version.sh && echo $SAGE_VERSION

package:
  - name: Full binary tarball
    dist: |
        tar cjf {dist}/sage-{version}-{osname}-{arch}.tar.bz2 {path}
    files:
      - include: '**'
      - exclude: '**.pyc'
      - exclude: '**.dvi'       # pascal strings?
      - exclude: upstream/**
      - exclude: src/doc/output/doctrees/**   # weird string terminators
      - exclude: src/build/lib.*/**
      - exclude: src/build/temp.*/**
      - exclude: logs/**
    
  - name: Runtime binaries only
    dist: |
        tar cjf {dist}/sage-runtime-{version}-{osname}-{arch}.tar.bz2 {path}
    files:
      - include: '**'
      - exclude: '**.pyc'
      - exclude: '**.dvi'       # dvi does not use null-terminated strings
      - exclude: upstream/**
      - exclude: logs/**
      - exclude: build/**
      - exclude: src/**
      - exclude: local/lib/**.a
      - exclude: .git/**
    strip: True
